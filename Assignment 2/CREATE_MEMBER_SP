create or replace procedure CREATE_MEMBER_SP (
    p_person_ID             IN INTEGER,  -- an output parameter
    /*p_person_email          IN  VARCHAR,  -- passed through to CREATE_PERSON_SP
    P_person_given_name     IN  VARCHAR,  -- passed through to CREATE_PERSON_SP
    p_person_surname        IN  VARCHAR,  -- passed through to CREATE_PERSON_SP
    p_person_phone          IN  VARCHAR,  -- passed through to CREATE_PERSON_SP*/
    p_location_id           IN INTEGER,  -- an output parameter
    /*p_location_country	    IN  VARCHAR,  -- passed through to CREATE_LOCATION_SP
    p_location_postal_code  IN	VARCHAR,  -- passed through to CREATE_LOCATION_SP
    p_location_street1	    IN	VARCHAR,  -- passed through to CREATE_LOCATION_SP
    p_location_street2	    IN	VARCHAR,  -- passed through to CREATE_LOCATION_SP
    p_location_city	        IN	VARCHAR,  -- passed through to CREATE_LOCATION_SP
    p_location_administrative_region IN VARCHAR, -- passed through to CREATE_LOCATION_SP*/
    p_member_password       IN  VARCHAR   -- NOT NULL  
)
IS
ex_Error EXCEPTION;
lv_errormsg_txt VARCHAR(100);

BEGIN
IF P_person_id is NULL THEN
   RAISE ex_Error;
    END IF;

IF p_location_id is NULL THEN
   RAISE ex_Error;
    END IF;
    
    INSERT INTO vm_member (
    person_id,
    member_password,
    location_id
) VALUES (
    P_person_id,
    p_member_password,
    p_location_id 
);

COMMIT;

      EXCEPTION
 WHEN ex_Error THEN
    DBMS_OUTPUT.PUT_LINE (lv_errormsg_txt);
    DBMS_OUTPUT.PUT_LINE('Error text:  "Missing mandatory value for parameter (x)  in context (y).  No member added."');
    DBMS_OUTPUT.PUT_LINE('Error meaning: A mandatory value is missing.  Here, y = "CREATE_MEMBER_SP"');
    DBMS_OUTPUT.PUT_LINE('Error effect: Because a mandatory value is not provided, no data are 
            inserted into the VM_MEMBER table.  The p_person_id value returned 
            is NULL.  ');
    ROLLBACK;
  WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Error text:  "Invalid value (x) in context (y). No member created."');
    DBMS_OUTPUT.PUT_LINE('Error meaning:  A value for parameter x is not valid.  Here, y = "CREATE_MEMBER_SP".
        This could arise if the person_id returned by CREATE_PERSON_SP is not valid,
        or the location_id returned by CREATE_LOCATION_SP is not valid. ');
    ROLLBACK;
 WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE ('THE ERROR CODE IS ' || SQLCODE);
    DBMS_OUTPUT.PUT_LINE ('THE ERROR msg IS ' || SQLCODE);
    ROLLBACK;
       
END;
